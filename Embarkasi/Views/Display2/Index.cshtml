@{
    ViewBag.Title = "Display2"; Layout = null;
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Shift Corner</title>
    <!-- Custom fonts for this template-->
    <link href="~/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
    <!-- Custom styles for this template-->
    <link href="~/css/sb-admin-2.min.css" rel="stylesheet">
    <style>
        #time {
            font-size: 2rem;
            color: #0ff;
            text-shadow: 0 0 10px #0ff, 0 0 20px #0ff;
        }

        #shift {
            font-size: 50px;
            color: #0ff;
            text-shadow: 0 0 10px #0ff, 0 0 20px #0ff;
        }

        .swal2-popup-custom {
            border: 1px solid #3a3a56;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.7);
            border-radius: 8px;
        }

        body {
            background-color: black;
            color: white;
            background-image: url('img/wallpaper.jpg'); /* Path ke gambar */
            background-size: cover; /* Membuat gambar memenuhi layar */
            background-repeat: no-repeat;
            background-attachment: fixed; /* Latar belakang tetap saat menggulir */
            background-position: center center; /* Gambar berada di tengah */
            position: relative; /* Posisi relatif untuk overlay */
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
        }

            body::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.6); /* Overlay hitam dengan transparansi */
                z-index: -1; /* Overlay berada di belakang konten */
            }

        #runningtext-container {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: #000f;
            color: white;
            font-size: 50px;
            overflow: hidden;
            white-space: nowrap;
        }

        .col-lg-5, .col-lg-6, .col-lg-1 {
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }

            .col-lg-5:hover, .col-lg-6:hover, .col-lg-1:hover {
                transform: scale(1.05);
                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            }

        .font-weight-bold {
            transition: background-color 0.3s ease-in-out;
        }

            .font-weight-bold:hover {
                background-color: #2e4c97;
            }
    </style>
</head>
<body id="page-top" id="204454">
    <div class="row" style="background-color: #000f; margin-top : 20px">
        <div class="col-lg-1">
            <center>
                <img src="~/img/logoshift.png" style="width: 130px; height: 130px;
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.7), 0 0 20px rgba(255, 255, 255, 0.6), 0 0 30px rgba(255, 255, 255, 0.5);
        transition: box-shadow 0.3s ease-in-out;"
                     onmouseover="this.style.boxShadow='0 0 20px rgba(255, 255, 255, 1), 0 0 40px rgba(255, 255, 255, 0.8), 0 0 60px rgba(255, 255, 255, 0.6)'"
                     onmouseout="this.style.boxShadow='0 0 10px rgba(255, 255, 255, 0.7), 0 0 20px rgba(255, 255, 255, 0.6), 0 0 30px rgba(255, 255, 255, 0.5)'">
            </center>

        </div>
        <div class="col-lg-7 text-left">
            <p style="font-size: 60px; margin-bottom: 0px;"><strong>SHIFT CORNER AREA 2</strong></p>
            <p style="font-size: 30px; margin-bottom: 0px;"><strong>PT UNGGUL DINAMIKA UTAMA</strong></p>

        </div>
        <div class="col-lg-2 text-right">
            <p id="time" style="font-size: 60px; margin-bottom: 0px;"><strong></strong></p>
            <p id="date" style="font-size: 30px; margin-bottom: 0px;"><strong></strong></p>

        </div>
        <div class="col-lg-2 text-right">
            <center>
                <p id="shift" style="font-size: 50px; margin: 2px;"></p>
            </center>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-2" style="background-color: #000f; margin-top : 20px">
            <center>
                <div class="font-weight-bold text-black" style="background-color: #FFA500; color: #000000; font-size: 30px; ">DOZER</div>
            </center>
            <div class="row" id="dozer" style="margin-left : 5px; margin-top :32px"></div>
        </div>
        <div class="col-lg-2" style="background-color: #000f; margin-top : 20px">
            <center>
                <div class="font-weight-bold text-black" style="background-color: #FFA500; color: #000000; font-size: 30px; ">GRADER</div>
            </center>
            <div class="row" id="grader" style="margin-left : 5px; margin-top :32px"></div>
        </div>
        <div class="col-lg-3" style="background-color: #000f; margin-top : 20px">
            <center>
                <div class="font-weight-bold text-black" style="background-color: #FFA500; color: #000000; font-size: 30px; ">EX SUPPORT</div>
            </center>
            <div class="row" id="exsuport" style="margin-left : 5px; margin-top :32px"></div>
        </div>
        <div class="col-lg-5" style="background-color: #000f; margin-top : 20px">
            <center>
                <div class="font-weight-bold text-black" style="background-color: #FFA500; color: #000000; font-size: 30px; ">DT SUPPORT</div>
            </center>
            <div class="row" id="dtsuport" style="margin-left : 5px; margin-top :32px"></div>
        </div>
    </div>
    <div id="runningtext-container">
        <p id="runningtext" style="font-size: 50px; margin: 2px;"></p>
    </div>
    <script src="~/vendor/chart.js/Chart.min.js"></script>
    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <!-- Include Perfect Scrollbar CSS and JS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery.perfect-scrollbar/1.5.2/css/perfect-scrollbar.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.perfect-scrollbar/1.5.2/js/perfect-scrollbar.jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jQuery.Marquee/1.5.0/jquery.marquee.min.js"></script>
    <script>
        var link = '@Url.Action("Function", "Controller")'
        var controller_name = "@ViewBag.Controller"
        var a
        $(document).ready(function () {
            document.body.style.zoom = "70%";
            getGrader()
            getDozer()
            getExSuport()
            getDtSuport()
            autoReloadPage()
            updateDateTime();
            runningText();
            setInterval(function () {
                checkForNewData();
                updateDateTime();
                updateShift();
            }, 1000);
        })

        function playNotificationSound() {
            const audio = new Audio('/mp3/ting.mp3');
            audio.play().catch(error => {
                console.error('Pemutaran audio gagal:', error);
            });
        }


        function checkForNewData() {
            var sectorLink = link.replace("Controller", "Display1").replace("Function", "GetAll");

            fetch(sectorLink)
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        const currentData = result.data;
                        const currentDataIds = currentData.map(item => item.id);
                        const newIds = currentDataIds.filter(id => !previousDataIds.includes(id));
                        if (newIds.length > 0) {
                            newIds.forEach(id => {
                                const newItem = currentData.find(item => item.id === id);
                                if (newItem) {
                                    Swal.fire({
                                        title: 'Data Finger Diterima!',
                                        html: `<strong>${newItem.nama_lengkap}</strong> - (${newItem.nik})`,
                                        icon: 'success',
                                        toast: true,
                                        background: '#f1c40f',
                                        color: '#cbcbcb',
                                        position: 'bottom-start',
                                        timer: 4000,
                                        showConfirmButton: false
                                    });

                                    playNotificationSound();
                                }
                            });
                            previousDataIds = [...new Set([...previousDataIds, ...newIds])];
                        }
                    } else {
                        console.error('Error:', result.message);
                    }
                })
                .catch(error => {
                    console.error('Fetch error:', error);
                });
        }

        function getGrader() {

            link = link.replace("Controller", "Display2");
            link = link.replace("Function", "GetGrader");
            $.ajax({
                type: "GET",
                url: link,
                success: function (data) {
                    if (data.status) {
                        $("#grader").append(data.data);
                    } else {
                        alert(data.data)
                    }
                }
            })
            link = '@Url.Action("Function", "Controller")'
        }


        function getDozer() {
            link = link.replace("Controller", "Display2");
            link = link.replace("Function", "GetDozer");
            $.ajax({
                type: "GET",
                url: link,
                success: function (data) {
                    if (data.status) {
                        $("#dozer").append(data.data);
                    } else {
                        alert(data.data)
                    }
                }
            })
            link = '@Url.Action("Function", "Controller")'
        }
        function getExSuport() {
            link = link.replace("Controller", "Display2");
            link = link.replace("Function", "GetExSuport");
            $.ajax({
                type: "GET",
                url: link,
                success: function (data) {
                    if (data.status) {
                        $("#exsuport").append(data.data);
                    } else {
                        alert(data.data)
                    }
                }
            })
            link = '@Url.Action("Function", "Controller")'
        }
        function getDtSuport() {
            link = link.replace("Controller", "Display2");
            link = link.replace("Function", "GetDtSuport");
            $.ajax({
                type: "GET",
                url: link,
                success: function (data) {
                    if (data.status) {
                        $("#dtsuport").append(data.data);
                    } else {
                        alert(data.data)
                    }
                }
            })
            link = '@Url.Action("Function", "Controller")'
        }



        function updateDateTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            const day = now.getDate().toString().padStart(2, '0');
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const year = now.getFullYear();

            const time = `${hours}:${minutes}:${seconds}`;
            const date = `${day}-${month}-${year}`;

            document.getElementById('time').textContent = time;
            document.getElementById('date').textContent = date;
        }


        function autoReloadPage() {
            setInterval(function () {
                location.reload();
            }, 80000);
        }

        function updateShift() {
            var shift = getShift();
            $('#shift').text(shift);
        }


        function getShift() {
            console.log('ssss')
            const now = new Date();
            const currentDay = now.getDay();
            const currentHour = now.getHours();
            if (currentDay !== 5) {
                if (currentHour >= 3 && currentHour < 13) {
                    return 'SHIFT 1';
                } else if (currentHour >= 13 && currentHour < 21) {
                    return 'SHIFT 2';
                } else if (currentHour >= 21 && currentHour < 24) {
                    return 'SHIFT 3';
                }
            } else {
                if ((currentHour >= 3 && currentHour < 15)) {
                    return 'SHIFT 1';
                } else {
                    return 'SHIFT 2';
                }
            }
        }

        function runningText() {
            var textLink = link.replace("Controller", "RunningText").replace("Function", "GetAll");
            $.ajax({
                url: textLink,
                type: 'GET',
                success: function (response) {
                    console.log("Response:", response); 
                    if (response.success) {

                        var texts = response.data.map(item => {
                            return `<span style="color: ${item.color || 'white'};">${item.text}</span>`;
                        }).join(' | '); 

                        $('#runningtext').html(texts); 

                        $('#runningtext').marquee({
                            duration: 15000,
                            gap: 50,      
                            delayBeforeStart: 0,
                            direction: 'left', 
                            duplicated: true,  
                        });
                    } else {
                        console.error("Pesan error:", response.message);
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Kesalahan saat mengambil data:', error);
                }
            });
        }
    </script>
</body>
</html>